# elasticsearch-analysis-hebrew-plugin

This repo is a **fork** focused on an embedded, optimized Hebrew analyzer for Elasticsearch 9.x.

## What is different in this fork

- Embedded DictaBERT model (no external Docker service)
- ONNX Runtime in-process inference
- INT8 quantized ONNX model
- Stopwords included **in the same plugin** (`heb_stopwords`)
- ES 9.x classic plugin with entitlements

## Build

Prerequisites:

- `python3` + `pip`
- Python deps: `hebrew-lemmatizer-embedded/model-export/requirements.txt`
- Docker (to build a Linux-compatible zip)

Install Python deps:

```
cd hebrew-lemmatizer-embedded/model-export
python3 -m pip install -r requirements.txt
```

Run the build script (exports INT8 ONNX + builds Linux zip):

```
./scripts/build_plugin_linux.sh
```

Note: the model file (`model.onnx`) is not stored in git. It is generated by
`export_model.py`. If you want the prebuilt model, download it from the GitHub
release assets.

Optional version overrides:

```
./scripts/build_plugin_linux.sh --es-version 9.3.0
```

Output:

```
hebrew-lemmatizer-embedded/plugin-lemmas-embedded/build/distributions/heb-lemmas-embedded-plugin-9.3.0.zip
```

## Install & test (local ES)

```
/path/to/elasticsearch/bin/elasticsearch-plugin remove heb-lemmas-embedded-plugin
/path/to/elasticsearch/bin/elasticsearch-plugin install file:///path/to/heb-lemmas-embedded-plugin-9.2.4.zip
/path/to/elasticsearch/bin/elasticsearch
```

```
curl -k -X POST "https://localhost:9200/_analyze" \
  -H "Content-Type: application/json" \
  -u "elastic:<password>" \
  -d '{"tokenizer":"whitespace","filter":["heb_lemmas","heb_stopwords"],"text":"הילדים אוכלים את הבננות"}'
```

## Create index example (settings + mappings)

```
curl -k -u "elastic:<password>" -X PUT "https://localhost:9200/hebrew_test" \
  -H "Content-Type: application/json" \
  -d '{
    "settings": {
      "analysis": {
        "analyzer": {
          "hebrew_analyzer": {
            "char_filter": ["html_strip"],
            "tokenizer": "whitespace",
            "filter": ["heb_lemmas", "heb_stopwords"]
          }
        }
      }
    },
    "mappings": {
      "properties": {
        "text": {
          "type": "text",
          "analyzer": "hebrew_analyzer"
        }
      }
    }
  }'
```

## Upgrade to a newer ES version (e.g., 9.3)

1. Run `./scripts/build_plugin_linux.sh --es-version <ES>`
3. Reinstall the new zip into ES and restart

   
   
